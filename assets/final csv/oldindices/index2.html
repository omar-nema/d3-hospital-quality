<!DOCTYPE html>
<meta charset="utf-8">
<style>

.bar {
  fill: steelblue;
}

.axis text{
   font: 12px monospace;
}

.chart text{
   font: 8px monospace;
}

  
.secondman {
  font: 80px monospace;
  transform: rotate(-90deg);
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.x.axis path {        
  display: none;
}

div.tooltip { 
    position: absolute;     
    text-align: center;     
    width: 80px;          
    height: 28px;         
    padding: 2px;       
    font: 8px monospace;    
    background: lightsteelblue; 
    border: 0px;    
    border-radius: 8px;     
    pointer-events: none;     
}
div.tooltip2 { 
    position: absolute;     
    text-align: center;     
    width: 400px;          
    height: 40px;         
    padding: 2px;       
    font: 10px monospace;    
/*    background: lightsteelblue; */
    border: 0px;    
    border-radius: 8px;     
    pointer-events: none;     
}



</style>
<head>
</head>
<body>
<svg class="chart">
<!-- <div id="btn">
    <input name="button" 
           type="button" 
           value="Update" 
       
            />
</div> -->

</svg>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<script>

function num(d) {
  d = +d; // coerce to number
  return d;
}



  var margin = {top: 20, right: 40, bottom: 30, left: 40},
    width = 550 - margin.left - margin.right,
    height = 400 - margin.top- - margin.bottom;

  var x = d3.scale.ordinal().rangeRoundBands([0, width], .1)
    var xAxis = d3.svg.axis().scale(x).orient("bottom");
  var y = d3.scale.linear().range([height, 0]);
  var yAxis = d3.svg.axis().scale(y).orient("left");
  var origcolor;
  // var z = d3.scale.ordinal()
  //   .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);
  var z = d3.scale.ordinal().range([ "#aad", "#556"]);

  // Define the div for the tooltip
var div = d3.select("body").append("div") 
    .attr("class", "tooltip")       
    .style("opacity", 0);
var div2 = d3.select("body").append("div") 
    .attr("class", "tooltip2")       
    .style("opacity", 0);


  var chart = d3.select(".chart")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  var source = 'data.csv'
  var source2 = 'data2.csv' 

var datasource=false;

       chart.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2)-2)
        .attr("text-anchor", "middle")  
        .style("font-size", "14px") 
                .on('mouseover',function(d){
          origcolor = this.style.fill
            div2.transition()   
                .duration(200)    
                .style("opacity", .9);    
            div2.html("displays comparison to deployment procedure")  
                .style("left", (d3.event.pageX) + "px")   
                .style("top", (d3.event.pageY - 28) + "px");  
            d3.select(this)
              .transition().duration(6000).style('fill','pink')
              .style('opacity',.5)
            })
          .on('mouseout',function(d){
                        div2.transition()    
                .duration(500)    
                .style("opacity", 0); 
            d3.select(this)
              .style('opacity',1)
              .style('fill',origcolor)
          })
                  ; 

function getsource(){
  if (datasource == false){
    datasource = true;
        // chart.select("text")
        // .attr("x", (width / 2))             
        // .attr("y", 0 - (margin.top / 2)+10)
        // .attr("text-anchor", "middle")  
        // .style("font-size", "16px")   
        // .text("[automation metrics]");

    return source;
  }
  else {
    datasource = false;
        // chart.select("text") 
        // .text("[checked in last month]");
    return source2;
  }
}

 d3.csv('data.csv',function(data){
  return {
    value: +data.value // convert "Length" column to number
  };})

  d3.csv('data2.csv',function(data){
  return {
    value: +data.value // convert "Length" column to number
  };})


  d3.csv('data.csv',function(data){
  return {
    value: +data.value // convert "Length" column to number
  };})


function initchart(sourcefile){

  d3.csv(sourcefile,function(data){


    var results = d3.layout.stack()(["value", "pre"].map(function(result) {
    return data.map(function(d) {
      return {x: d.type, y: +d[result]};
    });
  }));

    console.log()

      x.domain(results[0].map(function(d) { return d.x; }));
      //y.domain([0, d3.max(results[results.length - 1], function(d) { return  d.y; })]);
      y.domain([0, 33]);   //domain?

    chart.append('g').attr('class', 'x axis')
    .attr("transform", "translate(0, " + height + ")").call(xAxis);
    chart.append('g').attr('class', 'y axis').call(yAxis)
          .append('text')
          .attr('class', 'secondman') //demonstrating classes yo, text class overrides secondman
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("value");

    chart.append('g').attr('class', 'y axis')
    .attr("transform", "translate(" + width/2 + ",0)")
    .call(yAxis)`
          .append('text')
          .attr('class', 'secondman') 
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("value");


  chart.append('g').attr('class', 'y axis')
    .attr("transform", "translate(" + width/2 + ",0)")
    .call(yAxis)
          .append('text')
          .attr('class', 'secondman') 
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("value");

   var result = chart.selectAll("g.result").data(results)
   result.exit().remove()
   result.enter().append("chart:g").attr('class', 'result')
        .style('fill', function(d, i) {return z(i);})
        .style('stroke', function(d, i) {return d3.rgb(z(i)).darker();})
  

      var rectbuild =        
      result.selectAll('rect').data(Object)



      rectbuild.exit().remove();
      rectbuild.enter().append('rect')
      ;

      rectbuild
        .on('mouseover',function(d){
          origcolor = this.style.fill
            div.transition()   
                .duration(200)    
                .style("opacity", .9);    
            div .html(d.y + "<br/>"  + d.x + "")  
                .style("left", (d3.event.pageX) + "px")   
                .style("top", (d3.event.pageY - 28) + "px");  
            d3.select(this)
              .style('fill','pink')
              .style('opacity',.5)
            })
          .on('mouseout',function(d){
                        div.transition()    
                .duration(500)    
                .style("opacity", 0); 
            d3.select(this)
              .style('opacity',1)
              .style('fill',origcolor)
          })
                  ;

  result.selectAll('rect')   
      .transition()
      .duration(1000)
        .attr("x", function(d) { return x(d.x); })
        .attr("y", function(d) { return y(d.y) ; })
        .attr("width", x.rangeBand())
        .attr("height", function(d) { return height - y(d.y - d.y0)  ; })


      d3.selectAll('rect').on("click", function(d) {

      chart.selectAll('.x.axis').transition().duration(1000).remove()
      chart.selectAll('.y.axis').transition().duration(1000).remove()
   
      initchart(getsource());
       
  })

});

 

}


initchart(getsource());



       // var exit = chart.selectAll('g').exit()
        // exit.remove()

    // chart.selectAll('rect').exit().transition().duration(1000)
    // chart.selectAll('rect').remove()
    // chart.selectAll('g').remove().transition()
    // result.selectAll('rect').data(Object)
    //     .exit().remove();




   //  chart.append('g').attr('class', 'y axis').call(yaxiscost);
   //  chart.append('g').attr('class', 'y axis').call(yaxisincome).attr("transform", "translate(" + x2 + ",0)");
   //  chart.append('g').attr('class', 'y axis').call(yaxisquality).attr("transform", "translate(" + x3 + ",0)");
   //  chart.append('g').attr('class', 'y axis').call(yaxisinsured).attr("transform", "translate(" + x4 + ",0)");

   // var result1 = chart.selectAll("g.result").data(alldata[0]);
   //  var result2 = chart.selectAll("g.result").data(alldata[2]);
   //  var result3 = chart.selectAll("g.result").data(alldata[4]);
   // var result4 = chart.selectAll("g.result").data(alldata[5]);
   // result1.exit().remove();
   // result2.exit().remove();
   // result3.exit().remove();
   // result4.exit().remove();


   // result1.enter().append("chart:g").attr('class', 'result');
   // result2.enter().append("chart:g").attr('class', 'result');
   // result3.enter().append("chart:g").attr('class', 'result');
   // result4.enter().append("chart:g").attr('class', 'result');


   //    var circlebuild1 =        
   //    result1.selectAll('circle').data(alldata[0]);
   //          var circlebuild2 =        
   //    result2.selectAll('circle').data(alldata[2]);
   //          var circlebuild3 =        
   //    result3.selectAll('circle').data(alldata[4]);
   //          var circlebuild4 =        
   //    result4.selectAll('circle').data(alldata[5]);
   //          var circlebuild5 =        


   //    circlebuild1.exit().remove();
   //    circlebuild2.exit().remove();
   //          circlebuild2.exit().remove();
   //    circlebuild3.exit().remove();
   //          circlebuild1.exit().remove();
   //    circlebuild4.exit().remove();

   //    circlebuild1.enter().append('circle');
   //    circlebuild2.enter().append('circle');
   //    circlebuild3.enter().append('circle');
   //    circlebuild4.enter().append('circle');

   //    console.log(data.cost);

   //    // function d
   //    // return d[0].cost, d[0]

   //    result1.selectAll('circle')   
   //      .transition()
   //      .duration(1000)
   //      .attr("cx",'0')
   //      .attr("cy", function(d, i) { return ycost(alldata[0][i]); })
   //      .attr("r", function(d, i) { return alldata[1][i]/1000; });
   //    result2.selectAll('circle')   
   //      .transition()
   //      .duration(1000)
   //      .attr("cx", x2)
   //      .attr("cy", function(d, i) { return yincome(alldata[2][i]); })
   //      .attr("r", function(d, i) { return alldata[3][i]/10000; });
   //    result3.selectAll('circle')   
   //      .transition()
   //      .duration(1000)
   //      .attr("cx", x3)
   //      .attr("cy", function(d, i) { return yquality(alldata[4][i]); })
   //      .attr("r", 2);
   //    result4.selectAll('circle')   
   //      .transition()
   //      .duration(1000)
   //      .attr("cx", x4)
   //      .attr("cy", function(d, i) { return yinsured(alldata[5][i]); })
   //      .attr("r", 8);

//   result.selectAll('rect')   
      // .transition()
      // .duration(1000)
      //   .attr("x", function(d) { return x(d.x); })
      //   .attr("y", function(d) { return y(d.y) ; })
      //   .attr("width", x.rangeBand())
      //   .attr("height", function(d) { return height - y(d.y - d.y0)  ; })


      // chart.selectAll('.x.axis').transition().duration(1000).remove()
      // chart.selectAll('.y.axis').transition().duration(1000).remove()

          // .append('text')
          // .attr('class', 'secondman') //demonstrating classes yo, text class overrides secondman
          // .attr("y", 6)
          // .attr("dy", ".71em")
          // .style("text-anchor", "end")
          // .text("value");


       // var result = chart.selectAll("g.result").data(results)
       // result.exit().remove()
       // result.enter().append("chart:g").attr('class', 'result')
       //      .style('fill', function(d, i) {return z(i);})
       //      .style('stroke', function(d, i) {return d3.rgb(z(i)).darker();})
      






    
</script>







