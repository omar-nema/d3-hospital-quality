<!DOCTYPE html>
<meta charset="utf-8">
<style>


.axis text{
   font: 10px monospace;
}
.chart text{
   font: 10px monospace;
}
 .secondman {
  font: 80px monospace;
  transform: rotate(-90deg);
}

.axis path,
.axis line {
  fill: none;
/*  stroke: #000;*/
  stroke: black;
  stroke-width: 4px;
  shape-rendering: crispEdges;
  stroke-opacity: 0.20;
/*   stroke-opacity: 0.5;*/

}

/*.axis line2 {
  fill: none;
  stroke: blue;
  shape-rendering: crispEdges;

}*/

.x.axis path {        
  display: none;
}

div.tooltip { 
    position: absolute;     
    text-align: center;     
    width: 80px;          
    height: 28px;         
    padding: 2px;       
    font: 8px monospace;    
    background: lightsteelblue; 
    border: 0px;    
    border-radius: 8px;     
    pointer-events: none;     
}



</style>
<head>
</head>
<body>
<svg class="chart">
</svg>

</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
<!-- <script src="../colorbrewer.js"></script> -->
<script>

  var margin = {top: 20, right: 40, bottom: 30, left: 40},
    width = 800 - margin.left - margin.right,
    height = 400 - margin.top- - margin.bottom;

  var ycost = d3.scale.linear().range([height, 0]);
  // var yincome = d3.scale.linear().range([height, 0]);
  var yquality = d3.scale.linear().range([height, 0]);
  var ydischarge = d3.scale.linear().range([height, 0]);
  var yaxiscost = d3.svg.axis().scale(ycost).orient("left").tickSize(0);
  // var yaxisincome = d3.svg.axis().scale(yquality).orient("left").tickSize(0).tickValues([]);
  var yaxisquality = d3.svg.axis().scale(ydischarge).orient("left").tickSize(0).tickValues([]);
  var yaxisdischarge = d3.svg.axis().scale(ydischarge).orient("left").tickSize(0).tickValues([
    ]);

  var yefficiency = d3.scale.linear().range([height, 0]);
  var ypatexp = d3.scale.linear().range([height, 0]);
  var youtcome = d3.scale.linear().range([height, 0]);
  var yaxiseff = d3.svg.axis().scale(yquality).orient("left").tickSize(0).tickValues([]);
  var yaxispatexp = d3.svg.axis().scale(yquality).orient("left").tickSize(0).tickValues([]);
  var yaxisoutcome = d3.svg.axis().scale(yquality).orient("left").tickSize(0).tickValues([]);


  // Define the div for the tooltip
  var div = d3.select("body").append("div") 
      .attr("class", "tooltip")       
      .style("opacity", 0);
  var div2 = d3.select("body").append("div") 
      .attr("class", "tooltip2")       
      .style("opacity", 0);

  var chart = d3.select(".chart")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  d3.csv('allpercentile.csv',function(data){

          ycost.domain([0, 1]);
     //     yeffficiency.domain([0, 100]);
          yquality.domain([0, 1]);
          ydischarge.domain([0, 1]);
          //yvalues.domain([500, 25000]);

      //break up columns into variables, combine into alldata , PRESCALE
        var cost, quality, discharge, efficiency, patexp, outcome, bubblesize;
        var color, strokewidth; cost = [];  quality = []; discharge = []; efficiency = [];
        patexp = [];  outcome = []; color = []; strokewidth = []; bubblesize = [];

        // data = data.sort(function(a,b){return d3.descending(+a.discharge, +a.quality)});
        // data = data.filter(function(d,i){return i>1800});

        var provMap = {};
        data.forEach(function(d,i){
            provMap[i] = d.provider;
        });

        data.map(function(d){    
          cost.push(ycost(+d.cost));
          quality.push(yquality(+d.quality));
          efficiency.push(ycost(+d.efficiency));
          patexp.push(ycost(+d.patexp));
          outcome.push(ycost(+d.outcome));
          strokewidth.push(d.strokewidth);
          bubblesize.push(+d.bubblesize);
          return discharge.push(ydischarge(+d.discharge));
        }); 

       // var alldata2 =  [cost, patexp, outcome, discharge] ;
       var alldata2 =  [discharge, outcome, patexp, cost] ;
        var x1 = 0;
        var x2 = 1.5*width/3 ;
        var x3 = width ;
        var x4 = width ;

       //four axes
     var xvalues = [0, width*.4, width*.56, x3]

      //array created for scales, axes so that correct object is applied in for loop

      //var scales = [ycost, yincome, yquality, ydischarge];
      var yaxes = [yaxiscost, yaxiseff, yaxispatexp, yaxisoutcome, yaxisdischarge];


      //for LINE  
      //below getting y values (rows) of data to create lines
      function transpose(a) {
          return Object.keys(a[0]).map(
              function (c) { return a.map(function (r) { return r[c]; }); }
              );
          }
        var yvalrows = transpose(alldata2);
        var numRows =  yvalrows.length;
        var numColumns = alldata2.length;

      var colorscale = d3.scale.linear()
          .domain([0, numRows])
           .range(["#ff5050", "#ff5050"]); 
          // .range(["#00CED1", "#ff5050"]); 
        //.range(["#ff5050", "#ff5050"]); 
         // .range(["#00CED1", "red"]); 
        //.range(["#00CED1", "#ff5050"]); 

        //create 2d array for line x values
        var xvalrows = [];
            for (j = 0; j < numRows; j++) { 
                xvalrows.push(xvalues);
            }        
        //ay u want lines?

    chart.append('g').attr('class', 'lineholder');


        yvalrows.forEach(function(d, i){ //for each row, create a line

                  var currcolor = colorscale(i);
                  var currxvalrows = xvalrows[i];
                  var curryvalrows = yvalrows[i];
                  var currdata = [currxvalrows, curryvalrows];
                  var currTrans = transpose(currdata);
                  var currwidth = strokewidth[i];

                  var line = d3.svg.line()
                        .x(function(d, i) {
                            return d[0]; //formatted as 4 col, x row array
                        })
                        .y(function(d, i) {
                            return d[1];
                        })
                        .interpolate("linear")
// .               style("stroke", function() {
//                 return d.color = color(d.key); })
                        ;

        

                chart.select('.lineholder').append("polyline")
                    .style("stroke", colorscale(i)) 
                    .style("fill", "none")  
                    .style("fill", "none")  
                    //.style ('stroke-width', '.25px') 
                    .style ('stroke-width', currwidth) 
                    .attr("points", currTrans)
                    .on("mouseover", function(){
                        console.log([d, provMap[i]]);
                    });  
        })

        //chart.append()
        
        // var colors = ['lightgrey', 
        // ]
      //ay u want circles?

    chart.append('g').attr('class', 'axisholder');
      //result var created 
      var result = [];

      alldata2.forEach(function(d, i) {
          //i from 0 to 3, for each axis
          //declare variables that differ for each axis (like bubble size, y values)
          var currVal = alldata2[i];

          chart.select('.axisholder').append('g').attr('class', 'y axis').call(yaxes[i]).attr("transform", "translate(" + xvalues[i] + ",0)");
          //circles



         chart.append('g').attr('class', 'circleholder').selectAll('circle').data(alldata2[i]).enter().append(".circleholder:circle")   
         //chart.select('g.circleholder').data(alldata2[i]).enter().append("circle") 
        //chart.select('circleholder').data(alldata2[i]).enter().append("circle")  
            .attr("cx", xvalues[i])
            .attr("cy", function(d, i) { return currVal[i]; }) //can take str8 arrays! d, i based off array 
            //.attr("r", '100');
            .attr("r", function(d, i) { return bubblesize[i]; })
            .attr('fill', 'darkgrey')
            ;


    }); //(ay u like dem circles)


});

 



</script>







